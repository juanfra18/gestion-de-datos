-----------------------------------------------------------------------------------------------------
/*MIGRACION DE TABLAS*/
CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_INMUEBLES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.ESTADO_INMUEBLE (ESTADO_INMUEBLE_DESCRIPCION)
        SELECT DISTINCT(INMUEBLE_ESTADO) from GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_ESTADO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_INMUEBLES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ANUNCIOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.ESTADO_ANUNCIO (ESTADO_ANUNCIO_DESCRIPCION)
        SELECT DISTINCT(ANUNCIO_ESTADO) from GD2C2023.gd_esquema.Maestra WHERE ANUNCIO_ESTADO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ANUNCIOS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ALQUILERES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.ESTADO_ALQUILER (ESTADO_ALQUILER_DESCRIPCION)
        SELECT DISTINCT(ALQUILER_ESTADO) from GD2C2023.gd_esquema.Maestra WHERE ALQUILER_ESTADO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ALQUILERES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_OPERACIONES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.TIPO_OPERACION (TIPO_OPERACION_DESCRIPCION)
        SELECT DISTINCT (ANUNCIO_TIPO_OPERACION) FROM GD2C2023.gd_esquema.Maestra WHERE ANUNCIO_TIPO_OPERACION IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_TIPOS_OPERACIONES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_CARACTERISTICAS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.CARACTERISTICA (CARACTERISTICA_DESCRIPCION)
        VALUES('Cable'),('Calefaccion'),('Wifi'),('Gas')
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_CARACTERISTICAS ejecutado')
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_AGENTES_INMOBILIARIOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.AGENTE_INMOBILIARIO (AGENTE_INMOBILIARIO_NOMBRE, 
                                                            AGENTE_INMOBILIARIO_APELLIDO, 
                                                            AGENTE_INMOBILIARIO_DNI, 
                                                            AGENTE_INMOBILIARIO_MAIL,
                                                            AGENTE_INMOBILIARIO_TELEFONO,
                                                            AGENTE_INMOBILIARIO_FECHA_NACIMIENTO,
                                                            AGENTE_INMOBILIARIO_FECHA_REGISTRO,
                                                            AGENTE_INMOBILIARIO_SUCURSAL)
       SELECT  DISTINCT M.AGENTE_NOMBRE, M.AGENTE_APELLIDO, M.AGENTE_DNI,
		                M.AGENTE_MAIL,M.AGENTE_TELEFONO,M.AGENTE_FECHA_NAC,
                        M.AGENTE_FECHA_REGISTRO,
                        (SELECT SUCURSAL_ID FROM GUISO_DE_LENTEJAS.SUCURSAL WHERE M.SUCURSAL_CODIGO = SUCURSAL_ID)
                        FROM GD2C2023.gd_esquema.Maestra M
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_AGENTES_INMOBILIARIOS ejecutado')
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_DETALLES_IMPORTES_ALQUILERES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.DETALLE_IMPORTE_ALQUILER (DETALLE_IMPORTE_ALQUILER_NRO_PERIODO_INICIO,
                                                                DETALLE_IMPORTE_ALQUILER_NRO_PERIODO_FIN,
                                                                DETALLE_IMPORTE_ALQUILER_PRECIO,
                                                                DETALLE_IMPORTE_ALQUILER_ALQUILER)
        SELECT DISTINCT 
               DETALLE_ALQ_NRO_PERIODO_INI, 
               DETALLE_ALQ_NRO_PERIODO_FIN, 
               DETALLE_ALQ_PRECIO, 
               ALQUILER_CODIGO 
			   FROM GD2C2023.gd_esquema.Maestra
			   WHERE DETALLE_ALQ_NRO_PERIODO_INI IS NOT NULL AND DETALLE_ALQ_NRO_PERIODO_FIN IS NOT NULL

    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_DETALLES_IMPORTES_ALQUILERES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ANUNCIOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.MIGRAR_ANUNCIOS  (ANUNCIO_ID,
                                                        ANUNCIO_FECHA_PUBLICACION,
                                                        ANUNCIO_PRECIO_PUBLICADO,
                                                        ANUNCIO_ESTADO,
                                                        ANUNCIO_FECHA_FINALIZACION,
                                                        ANUNCIO_COSTO_PUBLICACION,
                                                        ANUNCIO_AGENTE_INMOBILIARIO,
                                                        ANUNCIO_TIPO_OPERACION,
                                                        ANUNCIO_INMUEBLE,
                                                        ANUNCIO_MONEDA,
                                                        ANUNCIO_TIPO_PERIODO)
        SELECT DISTINCT 
                M.ANUNCIO_CODIGO,
                M.ANUNCIO_FECHA_PUBLICACION, 
                M.ANUNCIO_PRECIO_PUBLICADO, 
                (SELECT ESTADO_ANUNCIO_ID FROM GUISO_DE_LENTEJAS.ESTADO_ANUNCIO WHERE ESTADO_ANUNCIO_DESCRIPCION = M.ANUNCIO_ESTADO) AS ESTADO_ANUNCIO_ID, 
                M.ANUNCIO_FECHA_FINALIZACION,
                M.ANUNCIO_COSTO_ANUNCIO, 
                (SELECT AGENTE_INMOBILIARIO_ID FROM GUISO_DE_LENTEJAS.AGENTE_INMOBILIARIO WHERE M.AGENTE_NOMBRE = AGENTE_INMOBILIARIO_NOMBRE AND M.AGENTE_APELLIDO = AGENTE_INMOBILIARIO_APELLIDO AND M.AGENTE_DNI = AGENTE_INMOBILIARIO_DNI) AS AGENTE_INMOBILIARIO_ID,
                (SELECT TIPO_OPERACION_ID FROM GUISO_DE_LENTEJAS.TIPO_OPERACION WHERE M.ANUNCIO_TIPO_OPERACION = TIPO_OPERACION_DESCRIPCION) AS TIPO_OPERACION_ID, 
                M.INMUEBLE_CODIGO,
                (SELECT MONEDA_ID FROM GUISO_DE_LENTEJAS.MONEDA WHERE M.ANUNCIO_MONEDA = MONEDA_DESCRIPCION) AS MONEDA_ID,
                (SELECT TIPO_PERIODO_ID FROM GUISO_DE_LENTEJAS.TIPO_PERIODO WHERE M.ANUNCIO_TIPO_PERIODO = TIPO_PERIODO_DESCRIPCION) AS TIPO_PERIODO_ID
                FROM GD2C2023.gd_esquema.Maestra M
                WHERE M.INMUEBLE_CODIGO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ANUNCIOS ejecutado')
GO



CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_PAGOS_ALQUILER
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.PAGO_ALQUILER (PAGO_ALQUILER_ID,  
                                                    PAGO_ALQUILER_FECHA_INICIO,
                                                    PAGO_ALQUILER_FECHA_VENCIMIENTO,
                                                    PAGO_ALQUILER_FECHA_PAGO,
                                                    PAGO_ALQUILER_NRO_PERIODO,
                                                    PAGO_ALQUILER_DESC_PERIODO,
                                                    PAGO_ALQUILER_FECHA_FIN,
                                                    PAGO_ALQUILER_IMPORTE,
                                                    PAGO_ALQUILER_MEDIO_PAGO,
                                                    PAGO_ALQUILER_ALQUILER)
        SELECT DISTINCT(M.PAGO_ALQUILER_CODIGO),
        M.PAGO_ALQUILER_FEC_INI,
        M.PAGO_ALQUILER_FECHA_VENCIMIENTO,
        M.PAGO_ALQUILER_FECHA,
        M.PAGO_ALQUILER_NRO_PERIODO,
        M.PAGO_ALQUILER_DESC,
        M.PAGO_ALQUILER_FEC_FIN,
        M.PAGO_ALQUILER_IMPORTE,
        (SELECT MEDIO_DE_PAGO_ID FROM GUISO_DE_LENTEJAS.MEDIO_DE_PAGO WHERE M.PAGO_ALQUILER_MEDIO_PAGO = MEDIO_DE_PAGO_DESCRIPCION) AS MEDIO_DE_PAGO_ID,
        (SELECT ALQUILER_ID FROM GUISO_DE_LENTEJAS.ALQUILER WHERE M.ALQUILER_CODIGO = ALQUILER_ID) AS ALQUILER_ID
        from GD2C2023.gd_esquema.Maestra M WHERE PAGO_ALQUILER_CODIGO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_PAGOS_ALQUILER ejecutado')
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_INQUILINOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.INQUILINO (INQUILINO_NOMBRE, 
                                                INQUILINO_APELLIDO, 
                                                INQUILINO_DNI, 
                                                INQUILINO_FECHA_REGISTRO,
                                                INQUILINO_TELEFONO,
                                                INQUILINO_MAIL,
                                                INQUILINO_FECHA_NAC)
       SELECT  DISTINCT M.INQUILINO_NOMBRE, M.INQUILINO_APELLIDO, M.INQUILINO_DNI,
		                M.INQUILINO_FECHA_REGISTRO,M.INQUILINO_TELEFONO,M.INQUILINO_MAIL,
                        M.INQUILINO_FECHA_NAC
        FROM GD2C2023.gd_esquema.Maestra M WHERE INQUILINO_NOMBRE IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_INQUILINOS ejecutado')
GO

--PROBAR CUANDO ESTÉN MIGRADAS LAS TABLAS LOCALIDAD Y PROVINCIA

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_SUCURSALES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.SUCURSAL (SUCURSAL_ID, 
                                                SUCURSAL_NOMBRE,
                                                SUCURSAL_DIRECCION,
                                                SUCURSAL_TELEFONO,
                                                SUCURSAL_LOCALIDAD)
       SELECT  DISTINCT M.SUCURSAL_CODIGO, M.SUCURSAL_NOMBRE, M.SUCURSAL_DIRECCION,
		                M.SUCURSAL_TELEFONO,L.LOCALIDAD_ID
        FROM GD2C2023.gd_esquema.Maestra M JOIN GUISO_DE_LENTEJAS.LOCALIDAD L ON M.SUCURSAL_LOCALIDAD = L.LOCALIDAD_NOMBRE

    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_SUCURSALES ejecutado')
    DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
    SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.SUCURSAL)
    PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.SUCURSAL. Nuevas filas: ' + @CANTIDAD_REGISTROS)
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_PROPIETARIOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.PROPIETARIO (PROPIETARIO_NOMBRE,
                                                   PROPIETARIO_APELLIDO,
                                                   PROPIETARIO_DNI,
                                                   PROPIETARIO_FECHA_REGISTRO,
                                                   PROPIETARIO_TELEFONO,
                                                   PROPIETARIO_MAIL,
                                                   PROPIETARIO_FECHA_NAC)
       SELECT DISTINCT M.PROPIETARIO_NOMBRE, M.PROPIETARIO_APELLIDO, M.PROPIETARIO_DNI,
		                M.PROPIETARIO_FECHA_REGISTRO,M.PROPIETARIO_TELEFONO,M.PROPIETARIO_MAIL,
                        M.PROPIETARIO_FECHA_NAC
        FROM GD2C2023.gd_esquema.Maestra M WHERE PROPIETARIO_NOMBRE IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_PROPIETARIOS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_AMBIENTES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.AMBIENTE (AMBIENTE_DESCRIPCION)
        SELECT DISTINCT(INMUEBLE_CANT_AMBIENTES) from GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_CANT_AMBIENTES IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_AMBIENTES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_MEDIOS_DE_PAGO
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.MEDIO_DE_PAGO (MEDIO_DE_PAGO_DESCRIPCION)
        SELECT DISTINCT PAGO_ALQUILER_MEDIO_PAGO FROM GD2C2023.gd_esquema.Maestra WHERE PAGO_ALQUILER_MEDIO_PAGO IS NOT NULL
        UNION
        SELECT DISTINCT PAGO_VENTA_MEDIO_PAGO FROM GD2C2023.gd_esquema.Maestra WHERE PAGO_VENTA_MEDIO_PAGO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_MEDIOS_DE_PAGO ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_MONEDAS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.MONEDA (MONEDA_DESCRIPCION)
        SELECT DISTINCT ANUNCIO_MONEDA FROM GD2C2023.gd_esquema.Maestra WHERE ANUNCIO_MONEDA IS NOT NULL
        UNION
        SELECT DISTINCT PAGO_VENTA_MONEDA FROM GD2C2023.gd_esquema.Maestra WHERE PAGO_VENTA_MONEDA IS NOT NULL
        UNION
        SELECT DISTINCT VENTA_MONEDA FROM GD2C2023.gd_esquema.Maestra WHERE VENTA_MONEDA IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_MONEDAS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_INMUEBLES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.TIPO_INMUEBLE (TIPO_INMUEBLE_DESCRIPCION)
        SELECT DISTINCT INMUEBLE_TIPO_INMUEBLE FROM GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_TIPO_INMUEBLE IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_TIPOS_INMUEBLES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_PROVINCIAS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.PROVINCIA (PROVINCIA_NOMBRE)
        SELECT DISTINCT INMUEBLE_PROVINCIA FROM GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_PROVINCIA IS NOT NULL
        UNION
        SELECT DISTINCT SUCURSAL_PROVINCIA FROM GD2C2023.gd_esquema.Maestra WHERE SUCURSAL_PROVINCIA IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_PROVINCIAS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_DISPOSICIONES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.DISPOSICION (DISPOSICION_DESCRIPCION)
        SELECT DISTINCT INMUEBLE_DISPOSICION FROM GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_DISPOSICION IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_DISPOSICIONES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ORIENTACIONES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.ORIENTACION (ORIENTACION_DESCRIPCION)
        SELECT DISTINCT INMUEBLE_ORIENTACION FROM GD2C2023.gd_esquema.Maestra WHERE INMUEBLE_ORIENTACION IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ORIENTACIONES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_PERIODOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.TIPO_PERIODO (TIPO_PERIODO_DESCRIPCION)
        SELECT DISTINCT ANUNCIO_TIPO_PERIODO FROM GD2C2023.gd_esquema.Maestra
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_TIPOS_PERIODOS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_COMPRADOR
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.COMPRADOR 
        (COMPRADOR_NOMBRE,COMPRADOR_APELLIDO,COMPRADOR_DNI,COMPRADOR_TELEFONO,COMPRADOR_MAIL,COMPRADOR_FECHA_NACIMIENTO,COMPRADOR_FECHA_REGISTRO)
        SELECT DISTINCT  COMPRADOR_NOMBRE,COMPRADOR_APELLIDO,COMPRADOR_DNI,COMPRADOR_TELEFONO,COMPRADOR_MAIL,COMPRADOR_FECHA_NAC,COMPRADOR_FECHA_REGISTRO 
        FROM gd_esquema.Maestra 
        WHERE COMPRADOR_NOMBRE IS NOT NULL
       
        DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
        SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.COMPRADOR)
        PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_COMPRADOR ejecutado')
        PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.COMPRADOR. Nuevas filas: ' + @CANTIDAD_REGISTROS)
    END
    
GO

/*NOMBRE Y PROVINCIA*/
CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_LOCALIDAD
AS
BEGIN 
INSERT INTO GUISO_DE_LENTEJAS.LOCALIDAD (LOCALIDAD_PROVINCIA,LOCALIDAD_NOMBRE)

  SELECT DISTINCT P.PROVINCIA_ID, MA.INMUEBLE_LOCALIDAD
  FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.PROVINCIA P ON MA.INMUEBLE_PROVINCIA = P.PROVINCIA_NOMBRE
  UNION
  SELECT DISTINCT P.PROVINCIA_ID, MA.SUCURSAL_LOCALIDAD
  FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.PROVINCIA P ON MA.SUCURSAL_PROVINCIA = P.PROVINCIA_NOMBRE

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.LOCALIDAD)
PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.LOCALIDAD. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_BARRIOS
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.BARRIO (BARRIO_NOMBRE, BARRIO_LOCALIDAD)
        SELECT DISTINCT M.INMUEBLE_BARRIO, 
        (SELECT LOCALIDAD_ID FROM GUISO_DE_LENTEJAS.LOCALIDAD WHERE M.INMUEBLE_LOCALIDAD = LOCALIDAD_NOMBRE 
         AND LOCALIDAD_PROVINCIA = (SELECT PROVINCIA_ID FROM GUISO_DE_LENTEJAS.PROVINCIA WHERE PROVINCIA_NOMBRE = M.INMUEBLE_PROVINCIA)) AS LOCALIDAD_ID
        FROM GD2C2023.gd_esquema.Maestra M WHERE M.INMUEBLE_BARRIO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_BARRIOS ejecutado')
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_LOCALIDAD
AS
BEGIN 
INSERT INTO GUISO_DE_LENTEJAS.LOCALIDAD (LOCALIDAD_PROVINCIA,LOCALIDAD_NOMBRE)

  SELECT DISTINCT P.PROVINCIA_ID, MA.INMUEBLE_LOCALIDAD
  FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.PROVINCIA P ON MA.INMUEBLE_PROVINCIA = P.PROVINCIA_NOMBRE
  UNION
  SELECT DISTINCT P.PROVINCIA_ID, MA.SUCURSAL_LOCALIDAD
  FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.PROVINCIA P ON MA.SUCURSAL_PROVINCIA = P.PROVINCIA_NOMBRE

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.LOCALIDAD)
PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.LOCALIDAD. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO


CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_VENTA
AS
BEGIN
INSERT INTO GUISO_DE_LENTEJAS.VENTA
SELECT DISTINCT MA.VENTA_CODIGO AS VENTA_CODIGO,
 MA.VENTA_FECHA AS VENTA_FECHA,MA.VENTA_COMISION AS VENTA_COMISION,
 C.COMPRADOR_ID AS VENTA_COMPRADOR,A.ANUNCIO_ID AS VENTA_ANUNCIO,
 MO.MONEDA_ID AS VENTA_MONEDA
FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.COMPRADOR C ON MA.COMPRADOR_NOMBRE = C.COMPRADOR_NOMBRE AND MA.COMPRADOR_APELLIDO = C.COMPRADOR_APELLIDO AND MA.COMPRADOR_DNI=C.COMPRADOR_DNI 
JOIN GUISO_DE_LENTEJAS.ANUNCIO A ON MA.ANUNCIO_CODIGO = A.ANUNCIO_ID 
JOIN GUISO_DE_LENTEJAS.MONEDA MO ON MA.VENTA_MONEDA = MO.MONEDA_DESCRIPCION 
WHERE VENTA_CODIGO IS NOT NULL

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.VENTA)
PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.Venta. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO

 PAGO_VENTA_IMPORTE numeric(18,2) NOT NULL,
		PAGO_VENTA_VENTA numeric(18,0) NOT NULL,
		PAGO_VENTA_MONEDA numeric(18,0) NOT NULL,
		PAGO_VENTA_MEDIOPAGO numeric(18,0) NOT NULL,
		PAGO_VENTA_COTIZACION numeric(18,2) NOT NULL




CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_PAGO_VENTA
AS
BEGIN
INSERT INTO GUISO_DE_LENTEJAS.PAGO_VENTA(PAGO_VENTA_IMPORTE,PAGO_VENTA_VENTA,PAGO_VENTA_MONEDA,PAGO_VENTA_MEDIOPAGO,PAGO_VENTA_COTIZACION)
SELECT DISTINCT MA.PAGO_VENTA_IMPORTE,
 V.VENTA_CODIGO,MO.MONEDA_ID,
 ME.MEDIO_DE_PAGO_ID,
 MA.PAGO_VENTA_COTIZACION
FROM gd_esquema.Maestra MA JOIN GUISO_DE_LENTEJAS.VENTA V ON MA.VENTA_CODIGO = V.VENTA_CODIGO 
JOIN GUISO_DE_LENTEJAS.MONEDA A ON MA.PAGO_VENTA_MONEDA = MO.MONEDA_DESCRIPCION 
JOIN GUISO_DE_LENTEJAS.MEDIO_DE_PAGO ME ON MA.PAGO_VENTA_MEDIO_PAGO = ME.MEDIO_DE_PAGO_DESCRIPCION 

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM GUISO_DE_LENTEJAS.PAGO_VENTA)
PRINT('Datos migrados a la tabla GUISO_DE_LENTEJAS.PAGO_VENTA. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_INMUEBLE_CARACTERISTICAS
AS
    BEGIN
	    DECLARE @inmueble numeric(18,0)
	    DECLARE @wifi numeric(18,0)
	    DECLARE @cable numeric(18,0)
	    DECLARE @calefaccion numeric(18,0)
	    DECLARE @gas numeric(18,0)
        DECLARE @wifi_pk numeric(18,0)
        DECLARE @cable_pk numeric(18,0)
        DECLARE @calefaccion_pk numeric(18,0)
        DECLARE @gas_pk numeric(18,0)
	    DECLARE cursorInmueble CURSOR FOR (SELECT DISTINCT m.INMUEBLE_CODIGO, m.INMUEBLE_CARACTERISTICA_WIFI , m.INMUEBLE_CARACTERISTICA_CABLE , m.INMUEBLE_CARACTERISTICA_CALEFACCION , m.INMUEBLE_CARACTERISTICA_GAS FROM gd_esquema.Maestra m WHERE m.INMUEBLE_CODIGO IS NOT NULL)

        SET @wifi_pk = (SELECT c.CARACTERISTICA_ID FROM GUISO_DE_LENTEJAS.CARACTERISTICA c WHERE c.CARACTERISTICA_DESCRIPCION = 'Wifi')
        SET @cable_pk = (SELECT c.CARACTERISTICA_ID FROM GUISO_DE_LENTEJAS.CARACTERISTICA c WHERE c.CARACTERISTICA_DESCRIPCION = 'Cable')
        SET @calefaccion_pk = (SELECT c.CARACTERISTICA_ID FROM GUISO_DE_LENTEJAS.CARACTERISTICA c WHERE c.CARACTERISTICA_DESCRIPCION = 'Calefaccion')
        SET @gas_pk = (SELECT c.CARACTERISTICA_ID FROM GUISO_DE_LENTEJAS.CARACTERISTICA c WHERE c.CARACTERISTICA_DESCRIPCION = 'Gas')


	    OPEN cursorInmueble
	    FETCH NEXT FROM cursorInmueble
	    INTO @inmueble, @wifi, @cable, @calefaccion, @gas

	    WHILE @@FETCH_STATUS = 0
		BEGIN
			IF @wifi = 1
			BEGIN
				INSERT INTO GUISO_DE_LENTEJAS.INMUEBLE_CARACTERISTICA (INMUEBLE_ID, CARACTERISTICA_ID) VALUES (@inmueble, @wifi_pk)
			END
			IF @cable = 1
			BEGIN
				INSERT INTO GUISO_DE_LENTEJAS.INMUEBLE_CARACTERISTICA (INMUEBLE_ID, CARACTERISTICA_ID) VALUES (@inmueble, @cable_pk)
			END
			IF @calefaccion = 1
			BEGIN
				INSERT INTO GUISO_DE_LENTEJAS.INMUEBLE_CARACTERISTICA (INMUEBLE_ID, CARACTERISTICA_ID) VALUES (@inmueble, @calefaccion_pk)
			END
			IF @gas = 1
			BEGIN
				INSERT INTO GUISO_DE_LENTEJAS.INMUEBLE_CARACTERISTICA (INMUEBLE_ID, CARACTERISTICA_ID) VALUES (@inmueble, @gas_pk)
			END

			FETCH NEXT FROM cursorInmueble
			INTO @inmueble, @wifi, @cable, @calefaccion, @gas
		END

		CLOSE cursorInmueble
		DEALLOCATE cursorInmueble

	END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_INMUEBLE_CARACTERISTICAS ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_INMUEBLES
AS
    BEGIN
        INSERT INTO GUISO_DE_LENTEJAS.INMUEBLE (INMUEBLE_NUMERO, 
        										INMUEBLE_NOMBRE,
        										INMUEBLE_DESCRIPCION,
        										INMUEBLE_SUPERFICIETOTAL,
        										INMUEBLE_EXPENSAS,
        										INMUEBLE_ANTIGUEDAD,
        										INMUEBLE_DIRECCION,
        										INMUEBLE_AMBIENTE, --desde acá son FK
        										INMUEBLE_ESTADO,
        										INMUEBLE_TIPOINMUEBLE,
        										INMUEBLE_PROPIETARIO,
        										INMUEBLE_DISPOSICION,
        										INMUEBLE_ORIENTACION,
        										INMUEBLE_BARRIO)
        SELECT DISTINCT
        		m.INMUEBLE_CODIGO,
        		m.INMUEBLE_NOMBRE,
        		m.INMUEBLE_DESCRIPCION,
        		m.INMUEBLE_SUPERFICIETOTAL,
        		m.INMUEBLE_EXPESAS,
				m.INMUEBLE_ANTIGUEDAD,       		
        		m.INMUEBLE_DIRECCION,
        		(SELECT DISTINCT a.AMBIENTE_ID FROM GUISO_DE_LENTEJAS.AMBIENTE a WHERE a.AMBIENTE_DESCRIPCION = m.INMUEBLE_CANT_AMBIENTES),
        		(SELECT DISTINCT e.ESTADO_INMUEBLE_ID FROM GUISO_DE_LENTEJAS.ESTADO_INMUEBLE e WHERE e.ESTADO_INMUEBLE_DESCRIPCION  = m.INMUEBLE_ESTADO),
        		(SELECT DISTINCT t.TIPO_INMUEBLE_ID FROM GUISO_DE_LENTEJAS.TIPO_INMUEBLE t WHERE t.TIPO_INMUEBLE_DESCRIPCION  = m.INMUEBLE_TIPO_INMUEBLE),
        		(SELECT DISTINCT p.PROPIETARIO_ID FROM GUISO_DE_LENTEJAS.PROPIETARIO p WHERE p.PROPIETARIO_NOMBRE = m.PROPIETARIO_NOMBRE AND p.PROPIETARIO_APELLIDO = m.PROPIETARIO_APELLIDO AND p.PROPIETARIO_DNI = m.PROPIETARIO_DNI AND p.PROPIETARIO_FECHA_REGISTRO = m.PROPIETARIO_FECHA_REGISTRO AND p.PROPIETARIO_TELEFONO = m.PROPIETARIO_TELEFONO AND p.PROPIETARIO_MAIL = m.PROPIETARIO_MAIL AND p.PROPIETARIO_FECHA_NAC = m.PROPIETARIO_FECHA_NAC),
        		(SELECT DISTINCT d.DISPOSICION_ID FROM GUISO_DE_LENTEJAS.DISPOSICION d WHERE d.DISPOSICION_DESCRIPCION = m.INMUEBLE_DISPOSICION),
        		(SELECT DISTINCT o.ORIENTACION_ID FROM GUISO_DE_LENTEJAS.ORIENTACION o WHERE o.ORIENTACION_DESCRIPCION = m.INMUEBLE_ORIENTACION),
        		(SELECT DISTINCT b.BARRIO_ID FROM GUISO_DE_LENTEJAS.BARRIO b WHERE b.BARRIO_NOMBRE = m.INMUEBLE_BARRIO AND (SELECT l.LOCALIDAD_NOMBRE FROM GUISO_DE_LENTEJAS.LOCALIDAD l WHERE l.LOCALIDAD_ID = b.BARRIO_LOCALIDAD AND l.LOCALIDAD_PROVINCIA = (SELECT p.PROVINCIA_ID FROM GUISO_DE_LENTEJAS.PROVINCIA p WHERE p.PROVINCIA_NOMBRE = m.INMUEBLE_PROVINCIA)) = m.INMUEBLE_LOCALIDAD)
        		FROM gd_esquema.Maestra m
        		WHERE m.INMUEBLE_CODIGO IS NOT NULL
    END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_INMUEBLES ejecutado')
GO

CREATE PROCEDURE GUISO_DE_LENTEJAS.MIGRAR_ALQUILERES
AS
	BEGIN
		INSERT INTO GUISO_DE_LENTEJAS.ALQUILER (ALQUILER_ID,
												ALQUILER_FECHAINICIO,
												ALQUILER_FECHAFIN,
												ALQUILER_DURACION,
												ALQUILER_DEPOSITO,
												ALQUILER_COMISION,
												ALQUILER_GASTOSAVERIGUACIONES,
												ALQUILER_ESTADO,
												ALQUILER_ANUNCIO,
												ALQUILER_INQUILINO)
		SELECT DISTINCT 
				m.ALQUILER_CODIGO,
				m.ALQUILER_FECHA_INICIO,
				m.ALQUILER_FECHA_FIN ,
				m.ALQUILER_CANT_PERIODOS,
				m.ALQUILER_DEPOSITO ,
				m.ALQUILER_COMISION ,
				m.ALQUILER_GASTOS_AVERIGUA ,
				(SELECT DISTINCT e.ESTADO_ALQUILER_ID FROM GUISO_DE_LENTEJAS.ESTADO_ALQUILER e WHERE e.ESTADO_ALQUILER_DESCRIPCION = m.ALQUILER_ESTADO),
				(SELECT DISTINCT a.ANUNCIO_ID FROM GUISO_DE_LENTEJAS.ANUNCIO a WHERE a.ANUNCIO_ID = m.ANUNCIO_CODIGO ),
				(SELECT DISTINCT i.INQUILINO_ID FROM GUISO_DE_LENTEJAS.INQUILINO i
						WHERE i.INQUILINO_NOMBRE = m.INQUILINO_NOMBRE
						AND i.INQUILINO_APELLIDO = m.INQUILINO_APELLIDO 
						AND i.INQUILINO_DNI = m.INQUILINO_DNI 
						AND i.INQUILINO_TELEFONO = m.INQUILINO_TELEFONO  
						AND i.INQUILINO_MAIL = m.INQUILINO_MAIL  
						AND i.INQUILINO_FECHA_NAC = m.INQUILINO_FECHA_NAC  
						AND i.INQUILINO_FECHA_REGISTRO = m.INQUILINO_FECHA_REGISTRO)
				FROM gd_esquema.Maestra m 
				WHERE m.ALQUILER_CODIGO IS NOT NULL
	END
    PRINT('Stored Procedure GUISO_DE_LENTEJAS.MIGRAR_ALQUILERES ejecutado')
GO





-----------------------------------------------------------------------------------------------------
/*EJECUCION DE PROCEDURES*/
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_INMUEBLES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ANUNCIOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ESTADOS_ALQUILERES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_OPERACIONES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_CARACTERISTICAS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_MEDIOS_DE_PAGO
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_AMBIENTES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_PROPIETARIOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_INQUILINOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_PROVINCIAS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_LOCALIDAD
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_SUCURSALES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_PAGOS_ALQUILER
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_AGENTES_INMOBILIARIOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_DETALLES_IMPORTES_ALQUILERES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ANUNCIOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_MONEDAS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_INMUEBLES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_DISPOSICIONES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ORIENTACIONES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_TIPOS_PERIODOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_COMPRADOR
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_BARRIOS
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_VENTA
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_PAGO_VENTA
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_INMUEBLES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_ALQUILERES
EXECUTE GUISO_DE_LENTEJAS.MIGRAR_INMUEBLES

















